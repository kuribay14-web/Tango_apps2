<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>単語帳アプリ（登録・一覧付き）</title>
<style>
  body { font-family: -apple-system,BlinkMacSystemFont,"Helvetica Neue",Arial,sans-serif;
         max-width: 820px; margin: 24px auto; padding: 0 14px; background:#fafafa; color:#222; }
  h1 { text-align: center; margin: 8px 0 18px; }
  h2 { margin: 18px 0 10px; }
  .card { background:#fff; border:1px solid #e6e6e6; border-radius:10px; padding:14px; margin-bottom:16px; box-shadow:0 1px 3px rgba(0,0,0,.03); }
  label { display:block; margin:8px 0 4px; font-weight:600; }
  input[type="text"], select { width:100%; box-sizing:border-box; font-size:16px; padding:10px 12px; border:1px solid #ccc;
                               border-radius:8px; background:#fff; }
  .row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  .row-3 { display:grid; grid-template-columns:2fr 2fr 1.4fr; gap:12px; }
  button { font-size:16px; padding:12px 16px; border-radius:8px; border:1px solid #999; background:#f3f3f3; cursor:pointer; }
  button:active { background:#e7e7e7; }
  .btn-primary { background:#2b7cff; border-color:#2b7cff; color:#fff; }
  .btn-danger { background:#ff4d4f; border-color:#ff4d4f; color:#fff; }
  #word { font-size:2rem; font-weight:700; min-height:48px; text-align:center; word-break:break-word; }
  #meaning { margin-top:8px; font-size:1.2rem; color:#555; text-align:center; display:none; word-break:break-word; }
  #noWords { color:#d33; text-align:center; margin-top:10px; }
  table { width:100%; border-collapse:collapse; font-size:15px; }
  th, td { padding:10px 8px; border-bottom:1px solid #eee; vertical-align:top; }
  th { text-align:left; background:#fafcff; }
  .controls { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
  .muted { color:#777; font-size:14px; }
  @media (max-width:520px){
    .row, .row-3 { grid-template-columns:1fr; }
    button { width:100%; }
  }
</style>
</head>
<body>

<h1>単語帳アプリ</h1>

<!-- 出題カード -->
<div class="card">
  <h2>出題</h2>
  <div class="controls" style="margin-bottom:10px;">
    <label for="filter" style="margin:0;">品詞で絞り込み：</label>
    <select id="filter">
      <option value="">すべて</option>
      <option value="動詞">動詞</option>
      <option value="形容詞">形容詞</option>
      <option value="名詞">名詞</option>
      <option value="副詞">副詞</option>
      <option value="chunk">chunk</option>
      <option value="言い回し">言い回し</option>
      <option value="接続詞">接続詞</option>
      <option value="phrase">phrase</option>
    </select>
    <button id="nextBtn" class="btn-primary">次の単語</button>
    <button id="showBtn">意味を表示</button>
  </div>
  <div id="word"></div>
  <div id="meaning"></div>
  <div id="noWords"></div>
</div>

<!-- 登録フォーム -->
<div class="card">
  <h2>新規登録</h2>
  <div class="row-3">
    <div>
      <label for="enInput">英語（必須）</label>
      <input id="enInput" type="text" placeholder="例: tolerance">
    </div>
    <div>
      <label for="jpInput">日本語（必須）</label>
      <input id="jpInput" type="text" placeholder="例: 耐性">
    </div>
    <div>
      <label for="typeInput">品詞（必須）</label>
      <select id="typeInput">
        <option value="">選択してください</option>
        <option value="動詞">動詞</option>
        <option value="形容詞">形容詞</option>
        <option value="名詞">名詞</option>
        <option value="副詞">副詞</option>
        <option value="chunk">chunk</option>
        <option value="言い回し">言い回し</option>
        <option value="接続詞">接続詞</option>
        <option value="phrase">phrase</option>
      </select>
    </div>
  </div>
  <div class="controls" style="margin-top:10px;">
    <button id="addBtn" class="btn-primary">登録する</button>
    <span id="addMsg" class="muted"></span>
  </div>
</div>

<!-- クラウド保存・読み込みボタン -->
<div style="margin-top: 20px;">
  <button id="cloudSaveBtn">☁️ クラウドに保存</button>
  <button id="cloudLoadBtn">☁️ クラウドから読み込み</button>
  <span id="cloudMsg" style="margin-left: 10px; color: gray;"></span>
</div>


<!-- 一覧 -->
<div class="card">
  <h2>登録一覧</h2>
  <div class="row">
    <div>
      <label for="searchInput">検索（英語/日本語を部分一致）</label>
      <input id="searchInput" type="text" placeholder="例: idea / アイディア">
    </div>
    <div>
      <label for="listFilter">品詞で絞り込み</label>
      <select id="listFilter">
        <option value="">すべて</option>
        <option value="動詞">動詞</option>
        <option value="形容詞">形容詞</option>
        <option value="名詞">名詞</option>
        <option value="副詞">副詞</option>
        <option value="chunk">chunk</option>
        <option value="言い回し">言い回し</option>
        <option value="接続詞">接続詞</option>
        <option value="phrase">phrase</option>
      </select>
    </div>
  </div>

  <div class="controls" style="margin:10px 0;">
    <button id="clearAllBtn" class="btn-danger">すべて削除（初期データに戻す）</button>
    <span class="muted">※取り消し不可。必要なら事前にバックアップしてください。</span>
  </div>

  <div style="overflow:auto;">
    <table id="listTable">
      <thead>
        <tr>
          <th style="min-width:180px;">英語</th>
          <th style="min-width:220px;">日本語</th>
          <th style="min-width:110px;">品詞</th>
          <th style="min-width:80px;">操作</th>
        </tr>
      </thead>
      <tbody id="listBody"></tbody>
    </table>
  </div>
</div>

<script>
// ====== 初期データ（必要に応じて編集可） ======
const SEED = [
  { word: "roughly", meaning: "だいたい", type: "副詞" },
  { word: "thirtyish", meaning: "30くらい", type: "形容詞" },
  { word: "late-fourties", meaning: "40代後半", type: "形容詞" },
  { word: "tallish", meaning: "とても高い", type: "形容詞" },
  { word: "outgoing", meaning: "社交的", type: "形容詞" },
  { word: "attractive", meaning: "魅力的", type: "形容詞" },
  { word: "chubby", meaning: "ぽっちゃり", type: "形容詞" },
  { word: "vary", meaning: "多様に変化する", type: "動詞" },
  { word: "tolerate", meaning: "許容する", type: "動詞" },
  { word: "high tolerance", meaning: "高い耐性", type: "名詞" },
  { word: "precision", meaning: "正確さ", type: "名詞" },
  { word: "directness", meaning: "率直さ", type: "名詞" },
  { word: "intercultural", meaning: "異文化間の", type: "形容詞" },
  { word: "norm", meaning: "典型、規範", type: "名詞" },
  { word: "awareness", meaning: "自覚、気づき", type: "名詞" },
  { word: "weigh up pros and cons of", meaning: "メリデメを比較検討する", type: "動詞" },
  { word: "talk A through B", meaning: "AにBを一通り説明する", type: "動詞" },
  { word: "You probably won't like this idea but", meaning: "この案は気に食わないだろうけど", type: "chunk" },
  { word: "get on to", meaning: "～の話題に入る", type: "動詞" },
  { word: "underlying causes", meaning: "根本原因", type: "名詞" },
  { word: "affect", meaning: "～に影響している", type: "動詞" },
  { word: "There's no getting away form it", meaning: "それは逃れられないことだ", type: "chunk" },
  { word: "attract", meaning: "惹きつける", type: "動詞" },
  { word: "Could I just say something here?", meaning: "ちょっといいですか？", type: "chunk" },
  { word: "obvious", meaning: "明らかな", type: "形容詞" },
  { word: "Apart form anything else", meaning: "何はともあれ", type: "chunk" },
  { word: "Can I suggest we come back to this point a bit later on?", meaning: "この話題は後で戻ってくる形でお願い", type: "chunk" },
  { word: "Either's fine.", meaning: "どっちでも大丈夫だよ", type: "chunk" },
  { word: "Enthusiasm", meaning: "熱意", type: "名詞" },
  { word: "bounce around new ideas", meaning: "新しいアイディアをあれこれ考える", type: "言い回し" },
  { word: "look beyond mistakes", meaning: "失敗の先を思い描く", type: "言い回し" },
  { word: "hit on a new idea", meaning: "新しいアイディアが浮かぶ", type: "言い回し" },
  { word: "come up with a new idea", meaning: "新しいアイディアが浮かぶ", type: "言い回し" },
  { word: "run into difficulty success waned", meaning: "成功率を下げる困難に直面する", type: "言い回し" },
  { word: "try things out", meaning: "（実験的に）試してみる", type: "言い回し" },
  { word: "figure out", meaning: "探し出す", type: "言い回し" },
  { word: "cut into the bottom line", meaning: "最終的な利益を減らす", type: "言い回し" },
  { word: "undergo change", meaning: "変化する、移り変わる", type: "言い回し" },
  { word: "shift emphasis to/from", meaning: "力点を移す、転換する", type: "言い回し" },
  { word: "boost earnings", meaning: "利益を押し上げる", type: "言い回し" },
  { word: "tolerate mistakes", meaning: "失敗を容認する（寛容に接する）", type: "言い回し" },
  { word: "cause stir", meaning: "センセーション・騒ぎを巻き起こす", type: "言い回し" },
  { word: "control costs", meaning: "コストをコントロールする", type: "言い回し" },
  { word: "outperform competition", meaning: "競合に勝つ", type: "言い回し" },
  { word: "outperform expectation", meaning: "期待を上回る", type: "言い回し" },
  { word: "reignite", meaning: "再燃させる", type: "言い回し" },
  { word: "get in the way of real invention", meaning: "本当の発明の妨げになる", type: "言い回し" },
  { word: "address employee dissatisfaction", meaning: "従業員の不満に本気で取組む", type: "言い回し" },
  { word: "fuse corporate culture and practice", meaning: "企業文化と企業活動を融和させる", type: "言い回し" },
  { word: "after observing their approach", meaning: "彼らのアプローチを観察した上で", type: "言い回し" },
  { word: "come to fruition", meaning: "実を結ぶ", type: "言い回し" },
  { word: "get off the ground", meaning: "動き出す、始動する", type: "言い回し" },
  { word: "get back on track", meaning: "再び軌道に乗る", type: "言い回し" },
  { word: "think outside the box", meaning: "型にはまらずに考える", type: "言い回し" },
  { word: "fall by the wayside", meaning: "途中で挫折する", type: "言い回し" },
  { word: "stay ahead of the game", meaning: "有利な状態を継続する", type: "言い回し" },
  { word: "vary depending on", meaning: "によって変化する", type: "言い回し" },
  { word: "dissonance", meaning: "不協和音", type: "名詞" },
  { word: "As such,", meaning: "そういうわけで", type: "言い回し" },
  { word: "point to", meaning: "を示している", type: "動詞" },
  { word: "take into account", meaning: "考慮する", type: "動詞" },
  { word: "emphasis on extreme precision", meaning: "極端に精度に力点を置くこと", type: "言い回し" },
  { word: "interfere with their operation", meaning: "オペレーションを妨げる", type: "言い回し" },
  { word: "result in", meaning: "に繋がる", type: "動詞" },
  { word: "lean", meaning: "引き締まった、無駄のない", type: "形容詞" },
  { word: "stifle creativity", meaning: "創造性を殺す", type: "言い回し" },
  { word: "go down the rabbit hole", meaning: "泥沼にハマる", type: "言い回し" },
  { word: "desire for approval", meaning: "承認欲求", type: "名詞" },
  { word: "phony", meaning: "ニセモノ（=fake）", type: "名詞" },
  { word: "be in the moment", meaning: "没頭する", type: "言い回し" },
  { word: "ball and chain", meaning: "足かせ", type: "名詞" },
  { word: "stay in touch", meaning: "連絡を取り合う", type: "動詞" },
  { word: "collocate", meaning: "並べる", type: "動詞" },
  { word: "tidy up", meaning: "片づける", type: "動詞" },
  { word: "messy", meaning: "散らかっている", type: "形容詞" },
  { word: "butter someone up", meaning: "お世辞を言う、おだてる", type: "動詞" },
  { word: "absenteeism", meaning: "常習欠勤", type: "名詞" },
  { word: "presenteeism", meaning: "病気でも出勤しちゃう状態", type: "名詞" },
  { word: "controversial", meaning: "物議を醸す", type: "形容詞" },
  { word: "chuckle", meaning: "くすくす笑いする", type: "動詞" },
  { word: "guffaw", meaning: "大笑いする", type: "動詞" },
  { word: "synonym", meaning: "同義語", type: "名詞" },
  { word: "Ferris wheel", meaning: "観覧車", type: "名詞" },
  { word: "nevertheless", meaning: "しかしながら（=However）", type: "接続詞" },
  { word: "amphibian", meaning: "両生類", type: "名詞" },
  { word: "astronaut", meaning: "宇宙飛行士", type: "名詞" },
  { word: "a blessing in disguise", meaning: "不幸中の幸い", type: "言い回し" },
  { word: "genuinely", meaning: "本当に", type: "副詞" },
  { word: "charitable", meaning: "慈善的な", type: "形容詞" },
  { word: "hypocritical", meaning: "偽善的な", type: "形容詞" },
  { word: "sporadic", meaning: "散発的な", type: "形容詞" },
  { word: "realistically", meaning: "現実的には", type: "副詞" },
  { word: "obsolete", meaning: "時代遅れの、廃れた", type: "形容詞" },
  { word: "I should also say that", meaning: "と私も言わせていただく", type: "言い回し" },
  { word: "move into the area of", meaning: "の領域に進出する", type: "言い回し" },
  { word: "We'd pay to make sure", meaning: "～を確実するためにお金を使う", type: "言い回し" },
  { word: "it's well-run", meaning: "うまく運営される", type: "言い回し" },
  { word: "I can't help wondering whether", meaning: "～かどうかを疑わざるをえない", type: "言い回し" },
  { word: "We'd need to do a lot more research", meaning: "もっと多くの～が必要である", type: "言い回し" },
  { word: "Can you be more specific?", meaning: "もっと具体的にお願いします", type: "言い回し" },
];

const LS_KEY = "vocab_words_v1";

// ====== ストレージ管理 ======
function loadWords() {
  try {
    const raw = localStorage.getItem(LS_KEY);
    if (!raw) return [...SEED];
    const parsed = JSON.parse(raw);
    // 配列でない/欠損時のフェイルセーフ
    if (!Array.isArray(parsed)) return [...SEED];
    return parsed;
  } catch(e) {
    return [...SEED];
  }
}

function saveWords(arr) {
  localStorage.setItem(LS_KEY, JSON.stringify(arr));
}

// ====== 状態 ======
let words = loadWords();
let currentList = [...words];
let currentWord = null;

// ====== DOM 取得 ======
const wordEl = document.getElementById("word");
const meaningEl = document.getElementById("meaning");
const filterEl = document.getElementById("filter");
const noWordsEl = document.getElementById("noWords");
const nextBtn = document.getElementById("nextBtn");
const showBtn = document.getElementById("showBtn");

const enInput = document.getElementById("enInput");
const jpInput = document.getElementById("jpInput");
const typeInput = document.getElementById("typeInput");
const addBtn = document.getElementById("addBtn");
const addMsg = document.getElementById("addMsg");

const listBody = document.getElementById("listBody");
const searchInput = document.getElementById("searchInput");
const listFilter = document.getElementById("listFilter");
const clearAllBtn = document.getElementById("clearAllBtn");

// ====== 出題系 ======
function pickRandom(list) {
  if (list.length === 0) return null;
  const i = Math.floor(Math.random() * list.length);
  return list[i];
}

function showWord() {
  if (!currentWord) return;
  wordEl.textContent = currentWord.word;
  meaningEl.style.display = "none";
  meaningEl.textContent = "";
  noWordsEl.textContent = "";
}

function showMeaning() {
  if (!currentWord) return;
  meaningEl.style.display = "block";
  meaningEl.textContent = `${currentWord.meaning} (${currentWord.type})`;
}

function applyQuizFilter() {
  const type = filterEl.value;
  currentList = type ? words.filter(w => w.type === type) : [...words];
  if (currentList.length === 0) {
    wordEl.textContent = "";
    meaningEl.style.display = "none";
    noWordsEl.textContent = "該当する単語がありません。";
    currentWord = null;
  } else {
    noWordsEl.textContent = "";
    currentWord = pickRandom(currentList);
    showWord();
  }
}

// ====== 登録 ======
function addEntry() {
  const en = enInput.value.trim();
  const jp = jpInput.value.trim();
  const tp = typeInput.value;

  if (!en || !jp || !tp) {
    addMsg.textContent = "英語・日本語・品詞はすべて必須です。";
    return;
  }
  // 重複チェック（英語×日本語×品詞）
  const exists = words.some(w => w.word === en && w.meaning === jp && w.type === tp);
  if (exists) {
    addMsg.textContent = "同一のレコードが既に存在します。";
    return;
  }

  const newItem = { word: en, meaning: jp, type: tp };
  words.unshift(newItem);
  saveWords(words);
  addMsg.textContent = "登録しました。";

  // 入力クリア
  enInput.value = "";
  jpInput.value = "";
  typeInput.value = "";

  // 出題・一覧の反映
  applyQuizFilter();
  renderList();
  // 一覧の検索条件があれば適用
  applyListFilter();
}

// ====== 一覧描画 ======
function renderList(data = words) {
  listBody.innerHTML = "";
  if (data.length === 0) {
    listBody.innerHTML = `<tr><td colspan="4" class="muted">データがありません。</td></tr>`;
    return;
  }
  data.forEach((w, idx) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${escapeHtml(w.word)}</td>
      <td>${escapeHtml(w.meaning)}</td>
      <td>${escapeHtml(w.type)}</td>
      <td><button data-index="${idx}" class="btn-danger small">削除</button></td>
    `;
    // 削除はインデックス特定のため、実データの位置を埋め込む
    const btn = tr.querySelector("button");
    btn.addEventListener("click", () => deleteEntry(w));
    listBody.appendChild(tr);
  });
}

function deleteEntry(item) {
  if (!confirm(`削除しますか？\n英語: ${item.word}\n日本語: ${item.meaning}`)) return;
  const i = words.findIndex(w => w.word === item.word && w.meaning === item.meaning && w.type === item.type);
  if (i >= 0) {
    words.splice(i, 1);
    saveWords(words);
    applyQuizFilter();
    applyListFilter();
  }
}

// ====== 一覧フィルタ（検索＋品詞） ======
function applyListFilter() {
  const q = (searchInput.value || "").toLowerCase();
  const t = listFilter.value;
  let data = [...words];
  if (t) data = data.filter(w => w.type === t);
  if (q) data = data.filter(w =>
    (w.word || "").toLowerCase().includes(q) ||
    (w.meaning || "").toLowerCase().includes(q) ||
    (w.meaning || "").includes(searchInput.value) // 日本語は大文字小文字関係ないので追加
  );
  renderList(data);
}

// ====== すべて削除（初期化） ======
function clearAll() {
  if (!confirm("すべての登録データを削除して初期データに戻します。よろしいですか？")) return;
  words = [...SEED];
  saveWords(words);
  applyQuizFilter();
  applyListFilter();
}

// ====== ユーティリティ ======
function escapeHtml(str) {
  return String(str).replace(/[&<>"']/g, s => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[s]));
}

// ====== イベント紐付け ======
nextBtn.addEventListener("click", () => {
  if (currentList.length === 0) { noWordsEl.textContent = "単語がありません。"; return; }
  currentWord = pickRandom(currentList);
  showWord();
});
showBtn.addEventListener("click", showMeaning);
filterEl.addEventListener("change", applyQuizFilter);

addBtn.addEventListener("click", addEntry);
searchInput.addEventListener("input", applyListFilter);
listFilter.addEventListener("change", applyListFilter);
clearAllBtn.addEventListener("click", clearAll);

// ====== 初期表示 ======
applyQuizFilter();
renderList();
</script>

<script>
const API_BASE = "https://tango-apps2.vercel.app"; // ←あなたのVercel URLに変更！

// クラウド保存機能
async function saveToCloud() {
  try {
    const res = await fetch(`${API_BASE}/api/save`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ content: words }) // words は既存の単語配列
    });
    if (!res.ok) throw new Error(await res.text());
    document.getElementById("cloudMsg").textContent = "✅ クラウドに保存しました（GitHubに反映済み）";
  } catch (e) {
    document.getElementById("cloudMsg").textContent = "❌ 保存に失敗しました：" + e.message;
  }
}

// クラウド読み込み機能
async function loadFromCloud() {
  try {
    const url = "https://raw.githubusercontent.com/kuribay14-web/Tango_apps2/main/data.json?ts=" + Date.now();
    const res = await fetch(url);
    if (!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();
    if (!Array.isArray(data)) throw new Error("JSONが配列ではありません");
    if (!confirm("クラウドのデータで上書きしますか？")) return;
    words = data;
    saveWords(words); // ←既存関数で localStorage に反映
    applyQuizFilter();
    applyListFilter();
    document.getElementById("cloudMsg").textContent = "✅ クラウドから読み込みました";
  } catch (e) {
    document.getElementById("cloudMsg").textContent = "❌ 読み込みに失敗しました：" + e.message;
  }
}

document.getElementById("cloudSaveBtn").addEventListener("click", saveToCloud);
document.getElementById("cloudLoadBtn").addEventListener("click", loadFromCloud);
</script>

</body>
</html>
